"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[964],{5964:(e,t,s)=>{s.d(t,{default:()=>d});var r=s(5155),a=s(2115),n=s(1392),l=s(6671),o=s(3599),c=s(8426);let i=["#FF3D20","#454CFF","#089420","#3E006F","#000000"],d=()=>{let[e,t]=(0,a.useState)([]),[s,d]=(0,a.useState)(""),[u,m]=(0,a.useState)(!0),{publicKey:g,connected:f}=(0,n.v)(),h=(0,a.useRef)(null),x=(0,a.useRef)(null),{websocket:p,onMessage:b}=(0,c.h)(),w=g&&"4uk73s677wA3w1zjmpFeUXYcgyZd51WDQcBuHkLmVswC,6fpDAqBW7XAeGy744Ukcu6qSQW1QTbfM1YtnJJQ2Nsfo,4MfVmmiA1YmmUH91MybhnTWrVywerF85PVtstRnCRmtN".split(",").includes(g.toBase58());(0,a.useEffect)(()=>{(async()=>{try{m(!0);let e=await fetch("https://7dfinzalu3.execute-api.ap-south-1.amazonaws.com/dev/?method=get_beg_live_messages&limit=100");if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let s=await e.json(),r=s.messages||s.data||[];t(r)}catch(e){console.error("Error fetching live messages:",e),l.o.error("Could not load chat messages")}finally{m(!1)}})()},[]),(0,a.useEffect)(()=>{let e=b(e=>{try{let s=JSON.parse(e.data);"begLiveMessage"===s.type||"begLiveMessageConfirmation"===s.type?(t(e=>e.some(e=>e._id===s.message_id)?e:[...e,{walletAddress:s.walletAddress,message:s.message,_id:s.message_id,timestamp:s.timestamp}]),setTimeout(()=>{x.current&&(x.current.scrollTop=x.current.scrollHeight)},100)):("begLiveMessageDeleted"===s.type||"begLiveMessageDeletedConfirmation"===s.type)&&(t(e=>e.filter(e=>e._id!==s.message_id)),"begLiveMessageDeletedConfirmation"===s.type&&l.o.success("Message deleted!"))}catch(e){console.error("Error parsing message:",e)}});return()=>{e()}},[b]),(0,a.useEffect)(()=>{var e;x.current&&(x.current.scrollTop=x.current.scrollHeight),null===(e=h.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[e]);let v=e=>i[e.charCodeAt(e.length-1)%i.length],y=()=>{if(!s.trim()){l.o.error("Please enter a message");return}if(s.length<4){l.o.error("Message must be at least 4 characters");return}if(!g){l.o.error("Please connect your wallet to chat");return}if((null==p?void 0:p.readyState)!==WebSocket.OPEN){l.o.error("Connection error. Please try again.");return}let e=s.match(/(https?:\/\/(?:www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b(?:[-a-zA-Z0-9()@:%_\+.~#?&//=]*))/gi);if(e&&e.some(e=>{let t=e.toLowerCase();return!(t.includes("twitter.com")||t.includes("x.com"))})){l.o.error("Only Twitter or X links are allowed");return}let t={action:"sendBegLiveMessage",walletAddress:g.toBase58(),message:s};p.send(JSON.stringify(t)),d("")},N=e=>{if(!g){l.o.error("Please connect your wallet");return}if(!w){l.o.error("Only admins can delete messages");return}if((null==p?void 0:p.readyState)!==WebSocket.OPEN){l.o.error("Connection error. Please try again.");return}let t={action:"deleteBegLiveMessage",walletAddress:g.toBase58(),messageId:e};p.send(JSON.stringify(t))},C=e=>{let t;let s=/(https?:\/\/(?:www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b(?:[-a-zA-Z0-9()@:%_\+.~#?&//=]*))/gi;if(!e.match(s))return e;let a=[],n=0;for(s.lastIndex=0;null!==(t=s.exec(e));)t.index>n&&a.push((0,r.jsx)("span",{className:"text-[#121212]",children:e.substring(n,t.index)},"text-".concat(n))),a.push((0,r.jsx)("a",{href:t[0],target:"_blank",rel:"noopener noreferrer nofollower",className:"text-[#3E006F] underline break-all",children:t[0]},"link-".concat(t.index))),n=t.index+t[0].length;return n<e.length&&a.push((0,r.jsx)("span",{className:"text-[#121212]",children:e.substring(n)},"text-".concat(n))),a};return(0,r.jsxs)("div",{className:"w-full mt-4 lg:m-0 h-[87%] bg-[#FFD44F] rounded-[8px] shadow-[0px_4px_4px_0px_rgba(0,0,0,0.25)] flex flex-col",children:[(0,r.jsxs)("div",{className:"flex-shrink-0 py-2 px-3 flex items-center justify-between relative",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("img",{src:"/assets/mfer-icon.svg",alt:"mfer",className:"w-10 h-10"}),(0,r.jsx)("p",{className:"text-[18px] text-[#121212] font-bold",children:"Formal chat"})]}),(0,r.jsx)("img",{src:"/assets/ws-pump.gif",alt:"pump",className:"absolute right-0 bottom-[4px] w-20 h-20"})]}),(0,r.jsx)("hr",{className:"w-full h-0 border-[0.5px] opacity-100 flex-shrink-0",style:{borderColor:"rgba(93, 48, 20, 0.34)"}}),(0,r.jsx)("div",{className:"flex-grow w-full flex flex-col items-center justify-between overflow-hidden min-h-0",children:(0,r.jsx)("div",{ref:x,className:"w-full flex-grow overflow-y-auto px-3 py-2 min-h-0",children:u?(0,r.jsx)("div",{className:"flex items-center justify-center py-10",children:(0,r.jsx)("div",{className:"w-6 h-6 border-3 border-[#5D3014] border-t-transparent rounded-full animate-spin"})}):0===e.length?(0,r.jsx)("div",{className:"flex items-center justify-center py-10",children:(0,r.jsx)("p",{className:"text-[#5D3014] text-sm",children:"No messages yet"})}):(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[e.map((e,t,s)=>(0,r.jsxs)("div",{className:"w-full flex flex-col items-start justify-start gap-1",children:[(0,r.jsx)("div",{className:"flex w-full items-center justify-between",children:(0,r.jsxs)("p",{className:"font-bold text-[14px]",style:{color:v(e.walletAddress)},children:[e.walletAddress.slice(0,4),"...",e.walletAddress.slice(-4),w&&(0,r.jsx)("img",{src:"/assets/delete-chat-icon.svg",alt:"delete",className:"w-4 h-4 cursor-pointer inline-block ml-2 relative bottom-[2px]",onClick:()=>N(e._id)})]})}),(0,r.jsx)("p",{className:"font-normal text-[14px] text-[#121212] break-all",children:C(e.message)}),t!==s.length-1?(0,r.jsx)("hr",{className:"w-full h-0 border-[0.5px] opacity-100",style:{borderColor:"rgba(93, 48, 20, 0.34)"}}):null]},e._id)),(0,r.jsx)("div",{ref:h})]})})}),(0,r.jsx)("div",{className:"flex-shrink-0 w-full px-3 py-2 [&>div]:w-full",children:f?(0,r.jsxs)("div",{className:"h-[40px] p-1 rounded-[4px] border border-[#5D3014] bg-white flex items-center gap-2",children:[(0,r.jsx)("input",{className:"grow outline-none border-none p-0 placeholder:text-[#8F95B2] text-[14px]",placeholder:"discuss",value:s,onChange:e=>{let t=e.target.value;t.length<=100&&d(t)},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),y())},maxLength:100}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("span",{className:"text-[10px] text-[#8F95B2]",children:[s.length,"/100"]}),(0,r.jsx)("img",{src:"/assets/send-live-msg-icon.svg",alt:"send",className:"w-8 h-8 cursor-pointer",onClick:y})]})]}):(0,r.jsxs)(o.x,{style:{background:"black",cursor:"pointer",padding:"4px 16px",width:"100%",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",color:"#FFD44F",fontWeight:800,height:"40px"},children:[(0,r.jsx)("img",{src:"/assets/solana-yellow-icon.svg",alt:"solana",className:"w-6 h-6"}),(0,r.jsx)("span",{className:"font-[ComicSans] text-[16px] text-[#FFD44F] font-bold",children:"Connect to chat"})]})})]})}},8426:(e,t,s)=>{s.d(t,{WebSocketProvider:()=>o,h:()=>c});var r=s(5155),a=s(2115),n=s(6671);let l=(0,a.createContext)(null);function o(e){let{children:t}=e,s=(0,a.useRef)(null),o=(0,a.useRef)(null),c=(0,a.useRef)(0),[i,d]=a.useState(!1),u=(0,a.useRef)([]),m=(0,a.useCallback)(()=>{var e;(null===(e=s.current)||void 0===e?void 0:e.readyState)!==WebSocket.OPEN&&(s.current&&s.current.close(),s.current=new WebSocket("wss://q1qqf9y8gb.execute-api.ap-south-1.amazonaws.com/dev/"),s.current.onopen=()=>{console.log("WebSocket connection established"),c.current=0,d(!0),o.current=setInterval(()=>{var e;(null===(e=s.current)||void 0===e?void 0:e.readyState)===WebSocket.OPEN&&s.current.send(JSON.stringify({type:"ping"}))},3e4)},s.current.onmessage=e=>{u.current.forEach(t=>t(e));try{let t=JSON.parse(e.data);switch(t.type){case"begMessage":case"begMessageConfirmation":window.dispatchEvent(new CustomEvent("begMessage",{detail:t}));break;case"begMessageUpdate":case"begMessageUpdateConfirmation":window.dispatchEvent(new CustomEvent("begMessageUpdate",{detail:t}));break;case"begMessageDeleted":case"begMessageDeletedConfirmation":window.dispatchEvent(new CustomEvent("begMessageDeleted",{detail:t}));break;case"begMessageReaction":case"begMessageReactionConfirmation":window.dispatchEvent(new CustomEvent("begMessageReaction",{detail:t}));break;case"begComment":case"begCommentConfirmation":window.dispatchEvent(new CustomEvent("begComment",{detail:t}));break;case"begCommentDeleted":case"begCommentDeletedConfirmation":window.dispatchEvent(new CustomEvent("begCommentDeleted",{detail:t}))}}catch(e){console.error("Error parsing message:",e),n.o.error("Error parsing message")}},s.current.onclose=()=>{console.log("WebSocket connection closed"),d(!1),o.current&&(clearInterval(o.current),o.current=null),setTimeout(()=>{console.log("Reconnecting WebSocket..."),m()},Math.min(1e3*Math.pow(2,c.current++),3e4))},s.current.onerror=e=>{console.error("WebSocket error:",e),d(!1)})},[]);(0,a.useEffect)(()=>(m(),()=>{o.current&&clearInterval(o.current),s.current&&s.current.close()}),[m]);let g=(0,a.useCallback)(e=>{var t;(null===(t=s.current)||void 0===t?void 0:t.readyState)===WebSocket.OPEN?s.current.send(JSON.stringify(e)):n.o.error("Connection error. Please try again.")},[]),f=(0,a.useCallback)(e=>(u.current.push(e),()=>{u.current=u.current.filter(t=>t!==e)}),[]);return(0,r.jsx)(l.Provider,{value:{sendMessage:g,isConnected:i,websocket:s.current,onMessage:f},children:t})}function c(){let e=(0,a.useContext)(l);if(!e)throw Error("useWebSocket must be used within a WebSocketProvider");return e}}}]);